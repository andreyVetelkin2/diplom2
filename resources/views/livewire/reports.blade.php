<div>
    <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header bg-primary text-white rounded-top-4 d-flex justify-content-between align-items-center">
            <h3 class="mb-0">üìä –°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç</h3>
        </div>

        <div class="card-body">
            {{-- –í–∫–ª–∞–¥–∫–∏ --}}
            <ul class="nav nav-pills mb-4 gap-2" id="reportTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link {{ $activeTab === 'individual' ? 'active' : '' }}"
                       wire:click.prevent="switchTab('individual')"
                       href="#individual-tab">üë§ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π</a>
                </li>
                @can('report-on-the-departments')
                    <li class="nav-item">
                        <a class="nav-link {{ $activeTab === 'department' ? 'active' : '' }}"
                           wire:click.prevent="switchTab('department')"
                           href="#department-tab">üèõ –ü–æ –∫–∞—Ñ–µ–¥—Ä–∞–º</a>
                    </li>
                @endcan

                @can('report-on-the-departments')
                    <li class="nav-item">
                        <a class="nav-link {{ $activeTab === 'user' ? 'active' : '' }}"
                           wire:click.prevent="switchTab('user')"
                           href="#department-tab">üôç –ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</a>
                    </li>
                @endcan
                @can('report-on-the-departments')
                    <li class="nav-item">
                        <a class="nav-link {{ $activeTab === 'achievement' ? 'active' : '' }}"
                           wire:click.prevent="switchTab('achievement')"
                           href="#department-tab">üìÑ –ü–æ —Ç–∏–ø—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</a>
                    </li>
                @endcan
                @can('report-on-the-departments')
                    <li class="nav-item">
                        <a class="nav-link {{ $activeTab === 'position' ? 'active' : '' }}"
                           wire:click.prevent="switchTab('position')"
                           href="#department-tab">üíº –ü–æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</a>
                    </li>
                @endcan
            </ul>

            {{-- –§–∏–ª—å—Ç—Ä—ã --}}
            <livewire:date-filter/>

            @if($activeTab === 'department')
                <div class="mt-3">
                    <label for="department" class="form-label fw-medium">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ñ–µ–¥—Ä—É:</label>
                    <select wire:model="selectedDepartment" id="department" multiple class="form-select">
                        <option value="">-- –≤—ã–±–µ—Ä–∏—Ç–µ --</option>
                        @foreach($departments as $id => $name)
                            <option value="{{ $id }}">{{ $name }}</option>
                        @endforeach
                    </select>
                </div>
            @endif

            @if($activeTab === 'user')
                <div class="mt-3">
                    <label for="user" class="form-label fw-medium">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <select wire:model="selectedUser" id="user" class="form-select">
                        <option value="">-- –≤—ã–±–µ—Ä–∏—Ç–µ --</option>
                        @foreach($users as $id => $name)
                            <option value="{{ $id }}">{{ $name }}</option>
                        @endforeach
                    </select>
                </div>
            @endif

            {{-- –¢–∞–±–ª–∏—Ü–∞ --}}
            <div class="table-responsive mt-4">
                <table class="table table-hover table-striped align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>‚Ññ</th>
                        <th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th>
                        <th>–û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ</th>
                        <th>–ë–∞–ª–ª—ã</th>
                        <th>–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($groupedData as $category)
                        <tr class="table-secondary text-center fw-bold">
                            <td colspan="5">{{ $category['category'] }}</td>
                        </tr>
                        @foreach($category['forms'] as $index => $form)
                            <tr>
                                <td>{{ $index + 1 }}</td>
                                <td>{{ $form['name'] }}</td>
                                <td><span class="text-muted">{{ $form['slug'] }}</span></td>
                                <td><span class="badge bg-info text-dark">{{ $form['total'] ?? '‚Äî' }}</span></td>
                                <td class="small text-muted">
                                    @foreach($form['entries'] as $entry)
                                        {{ $entry['outputLine'] }}<br>
                                    @endforeach


                                </td>
                            </tr>
                        @endforeach
                    @empty
                        <tr>
                            <td colspan="5" class="text-center text-muted">–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
            </div>
        </div>

        {{-- –§—É—Ç–µ—Ä --}}
        <div class="card-footer bg-light rounded-bottom-4">
            <div class="d-flex justify-content-end gap-2 mt-2">
                @if($groupedData && $activeTab === 'individual')
                    <button class="btn btn-outline-success" wire:click="exportIndividual">
                        <i class="bi bi-download me-1"></i>–°–∫–∞—á–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π DOCX
                    </button>
                @endif
                @if($groupedData && $activeTab === 'department')
                    <button class="btn btn-outline-success" wire:click="exportDepartment">
                        <i class="bi bi-download me-1"></i>–°–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç –ø–æ –∫–∞—Ñ–µ–¥—Ä–∞–º
                    </button>
                @endif
            </div>
        </div>
    </div>
</div>
